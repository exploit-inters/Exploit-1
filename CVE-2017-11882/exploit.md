# 漏洞原理分析


调试环境:  windows7_sp1_x86 + office 2007 x86 + windbg 6.12 x86

EQNEDT32.EXE version:  2000.11.9.0

该漏洞位于实现OLE接口的IPersistStorage::Load函数中。sub_40415B为ole的初始化过程，如下图1所示，它调用了sub_40440A函数，sub_40440A的主要作用是在初始化EQNEDT32.EXE实现的COM接口的各个函数指针。


# 从零开始构造exp

从正常插入的ole开始构造poc。为了方便构造poc，先用rtf插入了一个正常的Equation.3公式，提取出的Equation Native数据如下图所示，现在开始在此基础上构造一个弹出计算器的exp